!function(){"use strict";angular.module("socketio-auth",[])}(),function(){"use strict";function n(){var n,t,e,o=15;this.setDebug=function(n){e=n},this.setLoginUrl=function(t){n=t},this.setLogoutUrl=function(n){t=n},this.setReconnectionMaxTimeInSecs=function(n){o=1e3*n},this.$get=["$rootScope","$location","$timeout","$q","$window",function(e,c,i,r,u){function a(){return m}function f(){return v||h(),l()}function s(){v&&v.emit("logout",$)}function l(){var n=r.defer();return m.connected?n.resolve(v):d().then(function(){n.resolve(v)})["catch"](function(t){n.reject("USER_NOT_CONNECTED")}),n.promise}function d(){var n=r.defer();m.connected&&n.resolve(v);var t,c=e.$on("user_connected",function(){c(),t&&i.cancel(t),n.resolve(v)});return t=i(function(){c(),n.reject("TIMEOUT")},o),n.promise}function h(){function o(){s(!1),v.emit("authenticate",{token:$})}function c(){s(!1),e.$broadcast("user_disconnected")}function r(n){d(),localStorage.token=n,$=n,l($),s(!0),p($),e.$broadcast("user_connected",m)}function a(){d(),delete localStorage.token,s(!1),g(t||n)}function f(t){d(),s(!1),g(n)}function s(n){m.connected=n}function l(n){var t=h(n);return _.assign(m,t)}function d(){k&&i.cancel(k)}function h(n){var t=n.split(".")[1],e=t.replace("-","+").replace("_","/"),o=JSON.parse(u.atob(e));return o}function p(n){var t=h(n,{complete:!1}),e=t.dur,o=90*e/100|0;k=i(function(){v.emit("authenticate",{token:n})},1e3*o)}if(!v){var k;v=io.connect({forceNew:!0}),v.on("connect",o).on("authenticated",r).on("unauthorized",f).on("logged_out",a).on("disconnect",c),v.on("connect_error",function(){s(!1)})}}function p(){var n=c.search().token;return n||(n=localStorage.token),n}function g(n){window.location.replace(n||"badUrl.html")}var v,$=p(),m={connected:!1};return $&&(localStorage.token=$),{connect:f,logout:s,getSessionUser:a}}]}angular.module("socketio-auth").factory("sessionUser",["$auth",function(n){return n.getSessionUser()}]).provider("$auth",n)}(),function(){"use strict";function n(){var n;this.setDebug=function(t){n=t},this.$get=["$rootScope","$q","$auth",function(n,t,e){function o(t,o){e.connect().then(function(e){e.on(t,function(){var t=arguments;n.$apply(function(){o.apply(e,t)})})})}function c(t,o,c){e.connect().then(function(e){e.emit(t,o,function(){var t=arguments;n.$apply(function(){c&&c.apply(e,t)})})})}function i(n,t){return a(n,t)}function r(n,t){return a(n,t)}function u(n,t){return a(n,t)}function a(n,o){function c(e){var c=t.defer();return e.emit("api",n,o,function(n){n.code?c.reject({code:n.code,description:n.data}):c.resolve(n.data)}),c.promise}function i(n){return t.reject({code:"CONNECTION_ERR",description:n})}return e.connect().then(c,i)}return{on:o,emit:c,logout:e.logout,fetch:i,post:u,notify:r}}]}angular.module("socketio-auth").provider("$socketio",n)}();